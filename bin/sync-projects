#!/usr/bin/env python
from subprocess import call
import os
import re

# clone/pull all my repositories.
# TODO: automatically enumerate github

# Doing thins this way increases redundancy, highlights active projects and
# sets official origins.

active = [
	'git@github.com:naggie/dotfiles.git',
	'git@github.com:naggie/naggie.github.com.git',
	'git@github.com:naggie/darksky.git',
	'git@github.com:naggie/dscrates.git',
	'git@github.com:naggie/megafilter.git',
	'git@github.com:naggie/speakers.git',
	'naggie@chell.darksky.io:rcdos.git',
]

inactive = [
	'git@github.com:naggie/runuo.git',
	'git@github.com:naggie/nnplus.git',
	'git@github.com:naggie/ninja-motor-controller.git',
	'git@github.com:naggie/dschat.git',
	'git@github.com:naggie/DSPA.git',
	'git@github.com:naggie/averclock.git',
	'git@github.com:naggie/vosbox.git',
	'git@github.com:naggie/MLDASH.git',
	'git@github.com:naggie/algalon.git',
]

def sync(urls):
	origin = os.getcwd()
	for url in urls:
		dir = re.search(r"(\w+)\.git$",url).group(1)
		if os.path.exists('%s/.git' % dir):
			print 'PULL %s' % dir
			os.chdir(dir)
			call(['git','pull','origin','master'])
			call(['git','submodule','update'])
			os.chdir(origin)
		else:
			print 'INIT %s' % dir
			call(['git','clone','--recursive','--quiet',url,dir])

sync(active)
if not os.path.exists('INACTIVE'):
	os.makedirs('INACTIVE')

os.chdir('INACTIVE')
sync(inactive)
